angular.module("ui.bootstrap.dateparser",[]).service("uibDateParser",["$log","$locale","dateFilter","orderByFilter","filterFilter",function(e,t,r,n,i){function a(e){return i(d,{key:e},!0)[0]}function o(e){var t=[],r=e.split(""),i=e.indexOf("'");if(i>-1){var a=!1;e=e.split("");for(var o=i;o<e.length;o++)a?("'"===e[o]&&(o+1<e.length&&"'"===e[o+1]?(e[o+1]="$",r[o+1]=""):(r[o]="",a=!1)),e[o]="$"):"'"===e[o]&&(e[o]="$",r[o]="",a=!0);e=e.join("")}return angular.forEach(d,function(n){var i=e.indexOf(n.key);if(i>-1){e=e.split(""),r[i]="("+n.regex+")",e[i]="$";for(var a=i+1,o=i+n.key.length;a<o;a++)r[a]="",e[a]="$";e=e.join(""),t.push({index:i,key:n.key,apply:n.apply,matcher:n.regex})}}),{regex:new RegExp("^"+r.join("")+"$"),map:n(t,"index")}}function u(e){for(var t,r,n=[],i=0;i<e.length;)if(angular.isNumber(r)){if("'"===e.charAt(i))(i+1>=e.length||"'"!==e.charAt(i+1))&&(n.push(s(e,r,i)),r=null);else if(i===e.length)for(;r<e.length;)t=f(e,r),n.push(t),r=t.endIdx;i++}else"'"!==e.charAt(i)?(t=f(e,i),n.push(t.parser),i=t.endIdx):(r=i,i++);return n}function s(e,t,r){return function(){return e.substr(t+1,r-t-1)}}function f(e,t){for(var r=e.substr(t),n=0;n<d.length;n++)if(new RegExp("^"+d[n].key).test(r)){var i=d[n];return{endIdx:t+i.key.length,parser:i.formatter}}return{endIdx:t+1,parser:function(){return r.charAt(0)}}}function l(e,t,r){return!(r<1)&&(1===t&&r>28?29===r&&(e%4===0&&e%100!==0||e%400===0):3!==t&&5!==t&&8!==t&&10!==t||r<31)}function c(e){return parseInt(e,10)}function h(e,t){return e&&t?g(e,t):e}function p(e,t){return e&&t?g(e,t,!0):e}function y(e,t){e=e.replace(/:/g,"");var r=Date.parse("Jan 01, 1970 00:00:00 "+e)/6e4;return isNaN(r)?t:r}function m(e,t){return e=new Date(e.getTime()),e.setMinutes(e.getMinutes()+t),e}function g(e,t,r){r=r?-1:1;var n=e.getTimezoneOffset(),i=y(t,n);return m(e,r*(i-n))}var M,d,T=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g;this.init=function(){M=t.id,this.parsers={},this.formatters={},d=[{key:"yyyy",regex:"\\d{4}",apply:function(e){this.year=+e},formatter:function(e){var t=new Date;return t.setFullYear(Math.abs(e.getFullYear())),r(t,"yyyy")}},{key:"yy",regex:"\\d{2}",apply:function(e){e=+e,this.year=e<69?e+2e3:e+1900},formatter:function(e){var t=new Date;return t.setFullYear(Math.abs(e.getFullYear())),r(t,"yy")}},{key:"y",regex:"\\d{1,4}",apply:function(e){this.year=+e},formatter:function(e){var t=new Date;return t.setFullYear(Math.abs(e.getFullYear())),r(t,"y")}},{key:"M!",regex:"0?[1-9]|1[0-2]",apply:function(e){this.month=e-1},formatter:function(e){var t=e.getMonth();return/^[0-9]$/.test(t)?r(e,"MM"):r(e,"M")}},{key:"MMMM",regex:t.DATETIME_FORMATS_CN.MONTH.join("|"),apply:function(e){this.month=t.DATETIME_FORMATS_CN.MONTH.indexOf(e)},formatter:function(e){return r(e,"MMMM")}},{key:"MMM",regex:t.DATETIME_FORMATS_CN.SHORTMONTH.join("|"),apply:function(e){this.month=t.DATETIME_FORMATS_CN.SHORTMONTH.indexOf(e)},formatter:function(e){return r(e,"MMM")}},{key:"MM",regex:"0[1-9]|1[0-2]",apply:function(e){this.month=e-1},formatter:function(e){return r(e,"MM")}},{key:"M",regex:"[1-9]|1[0-2]",apply:function(e){this.month=e-1},formatter:function(e){return r(e,"M")}},{key:"d!",regex:"[0-2]?[0-9]{1}|3[0-1]{1}",apply:function(e){this.date=+e},formatter:function(e){var t=e.getDate();return/^[1-9]$/.test(t)?r(e,"dd"):r(e,"d")}},{key:"dd",regex:"[0-2][0-9]{1}|3[0-1]{1}",apply:function(e){this.date=+e},formatter:function(e){return r(e,"dd")}},{key:"d",regex:"[1-2]?[0-9]{1}|3[0-1]{1}",apply:function(e){this.date=+e},formatter:function(e){return r(e,"d")}},{key:"EEEE",regex:t.DATETIME_FORMATS_CN.DAY.join("|"),formatter:function(e){return r(e,"EEEE")}},{key:"EEE",regex:t.DATETIME_FORMATS_CN.SHORTDAY.join("|"),formatter:function(e){return r(e,"EEE")}},{key:"HH",regex:"(?:0|1)[0-9]|2[0-3]",apply:function(e){this.hours=+e},formatter:function(e){return r(e,"HH")}},{key:"hh",regex:"0[0-9]|1[0-2]",apply:function(e){this.hours=+e},formatter:function(e){return r(e,"hh")}},{key:"H",regex:"1?[0-9]|2[0-3]",apply:function(e){this.hours=+e},formatter:function(e){return r(e,"H")}},{key:"h",regex:"[0-9]|1[0-2]",apply:function(e){this.hours=+e},formatter:function(e){return r(e,"h")}},{key:"mm",regex:"[0-5][0-9]",apply:function(e){this.minutes=+e},formatter:function(e){return r(e,"mm")}},{key:"m",regex:"[0-9]|[1-5][0-9]",apply:function(e){this.minutes=+e},formatter:function(e){return r(e,"m")}},{key:"sss",regex:"[0-9][0-9][0-9]",apply:function(e){this.milliseconds=+e},formatter:function(e){return r(e,"sss")}},{key:"ss",regex:"[0-5][0-9]",apply:function(e){this.seconds=+e},formatter:function(e){return r(e,"ss")}},{key:"s",regex:"[0-9]|[1-5][0-9]",apply:function(e){this.seconds=+e},formatter:function(e){return r(e,"s")}},{key:"a",regex:t.DATETIME_FORMATS_CN.AMPMS.join("|"),apply:function(e){12===this.hours&&(this.hours=0),"PM"===e&&(this.hours+=12)},formatter:function(e){return r(e,"a")}},{key:"Z",regex:"[+-]\\d{4}",apply:function(e){var t=e.match(/([+-])(\d{2})(\d{2})/),r=t[1],n=t[2],i=t[3];this.hours+=c(r+n),this.minutes+=c(r+i)},formatter:function(e){return r(e,"Z")}},{key:"ww",regex:"[0-4][0-9]|5[0-3]",formatter:function(e){return r(e,"ww")}},{key:"w",regex:"[0-9]|[1-4][0-9]|5[0-3]",formatter:function(e){return r(e,"w")}},{key:"GGGG",regex:t.DATETIME_FORMATS_CN.ERANAMES.join("|").replace(/\s/g,"\\s"),formatter:function(e){return r(e,"GGGG")}},{key:"GGG",regex:t.DATETIME_FORMATS_CN.ERAS.join("|"),formatter:function(e){return r(e,"GGG")}},{key:"GG",regex:t.DATETIME_FORMATS_CN.ERAS.join("|"),formatter:function(e){return r(e,"GG")}},{key:"G",regex:t.DATETIME_FORMATS_CN.ERAS.join("|"),formatter:function(e){return r(e,"G")}}],angular.version.major>=1&&angular.version.minor>4&&d.push({key:"LLLL",regex:t.DATETIME_FORMATS_CN.STANDALONEMONTH.join("|"),apply:function(e){this.month=t.DATETIME_FORMATS_CN.STANDALONEMONTH.indexOf(e)},formatter:function(e){return r(e,"LLLL")}})},this.init(),this.getParser=function(e){var t=a(e);return t&&t.apply||null},this.overrideParser=function(e,t){var r=a(e);r&&angular.isFunction(t)&&(this.parsers={},r.apply=t)}.bind(this),this.filter=function(e,r){if(!angular.isDate(e)||isNaN(e)||!r)return e;r=t.DATETIME_FORMATS_CN[r]||r,t.id!==M&&this.init(),this.formatters[r]||(this.formatters[r]=u(r));var n=this.formatters[r];return n.reduce(function(t,r){return t+r(e)},"")},this.parse=function(r,n,i){if(!angular.isString(r)||!n)return r;n=t.DATETIME_FORMATS_CN[n]||n,n=n.replace(T,"\\$&"),t.id!==M&&this.init(),this.parsers[n]||(this.parsers[n]=o(n,"apply"));var a=this.parsers[n],u=a.regex,s=a.map,f=r.match(u),c=!1;if(f&&f.length){var h,p;angular.isDate(i)&&!isNaN(i.getTime())?h={year:i.getFullYear(),month:i.getMonth(),date:i.getDate(),hours:i.getHours(),minutes:i.getMinutes(),seconds:i.getSeconds(),milliseconds:i.getMilliseconds()}:(i&&e.warn("dateparser:","baseDate is not a valid date"),h={year:1900,month:0,date:1,hours:0,minutes:0,seconds:0,milliseconds:0});for(var y=1,m=f.length;y<m;y++){var g=s[y-1];"Z"===g.matcher&&(c=!0),g.apply&&g.apply.call(h,f[y])}var d=c?Date.prototype.setUTCFullYear:Date.prototype.setFullYear,E=c?Date.prototype.setUTCHours:Date.prototype.setHours;return l(h.year,h.month,h.date)&&(!angular.isDate(i)||isNaN(i.getTime())||c?(p=new Date(0),d.call(p,h.year,h.month,h.date),E.call(p,h.hours||0,h.minutes||0,h.seconds||0,h.milliseconds||0)):(p=new Date(i),d.call(p,h.year,h.month,h.date),E.call(p,h.hours,h.minutes,h.seconds,h.milliseconds))),p}},this.toTimezone=h,this.fromTimezone=p,this.timezoneToOffset=y,this.addDateMinutes=m,this.convertTimezoneToLocal=g}]);